<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Master Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, rgba(142, 45, 226, 0.9), rgba(74, 0, 224, 0.85)), 
                        url('https://images.unsplash.com/photo-1519791883288-dc8bd696e667?w=1600') center/cover fixed;
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .saving-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(39, 174, 96, 0.9);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            display: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        /* Student Info Screen */
        #info-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 40px 20px;
        }

        .info-container {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 25px;
            padding: 50px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .info-title {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .info-subtitle {
            font-size: 1.1em;
            color: #7f8c8d;
            margin-bottom: 35px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            font-size: 1.1em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: 3px solid #ddd;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: #8e2de2;
            box-shadow: 0 0 10px rgba(142, 45, 226, 0.3);
        }

        .btn-start {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
            padding: 18px;
            font-size: 1.2em;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        /* Menu Screen */
        #menu-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 40px 20px;
        }

        .menu-title {
            font-size: 4em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            color: #fff;
            text-shadow: 4px 4px 20px rgba(0,0,0,0.7);
            animation: fadeInDown 0.8s ease;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .menu-subtitle {
            font-size: 1.5em;
            color: #e0e0e0;
            margin-bottom: 15px;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.8);
        }

        .student-name-display {
            font-size: 1.3em;
            color: #fff;
            background: rgba(0,0,0,0.3);
            padding: 12px 25px;
            border-radius: 10px;
            margin-bottom: 40px;
        }

        .quiz-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            max-width: 1100px;
            width: 100%;
        }

        .quiz-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border: 3px solid transparent;
        }

        .quiz-card:hover {
            transform: translateY(-10px) scale(1.03);
            border-color: #8e2de2;
            box-shadow: 0 20px 60px rgba(142, 45, 226, 0.5);
        }

        .quiz-icon {
            font-size: 5em;
            margin-bottom: 20px;
            display: block;
        }

        .quiz-title {
            font-size: 1.8em;
            color: #2c3e50;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .quiz-description {
            font-size: 1.1em;
            color: #666;
            line-height: 1.6;
        }

        .quiz-count {
            display: inline-block;
            margin-top: 15px;
            padding: 8px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            font-size: 0.95em;
            font-weight: 600;
        }

        /* Quiz Screen */
        #quiz-screen {
            display: none;
            padding: 30px 20px;
            min-height: 100vh;
        }

        .quiz-container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .progress-section {
            margin-bottom: 30px;
        }

        .progress-container {
            width: 100%;
            height: 14px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c 0%, #f39c12 50%, #27ae60 100%);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-size: 0.95em;
            color: #555;
            font-weight: 600;
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 35px;
            padding-bottom: 20px;
            border-bottom: 3px solid #8e2de2;
        }

        .quiz-header h2 {
            font-size: 2.2em;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .student-info-display-quiz {
            background: #e8f4f8;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 1em;
            color: #2c3e50;
        }

        .question-counter {
            font-size: 1.1em;
            color: #7f8c8d;
            font-weight: 600;
        }

        .question-card {
            background: #f8f9fa;
            padding: 35px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 5px solid #8e2de2;
        }

        .question-word {
            font-size: 3em;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }

        .question-text {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .sentence-context {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 10px;
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 20px;
            line-height: 1.8;
            font-style: italic;
        }

        .sentence-context .blank {
            display: inline-block;
            border-bottom: 3px solid #8e2de2;
            min-width: 150px;
            text-align: center;
            font-weight: bold;
            color: #8e2de2;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-btn {
            padding: 20px;
            background: white;
            border: 3px solid #ddd;
            border-radius: 12px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .option-btn:hover {
            border-color: #8e2de2;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(142, 45, 226, 0.3);
        }

        .option-btn.selected {
            background: #8e2de2;
            color: white;
            border-color: #7520d4;
        }

        .option-btn.correct {
            background: #27ae60;
            color: white;
            border-color: #229954;
            animation: pulse 0.5s;
        }

        .option-btn.incorrect {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
            animation: shake 0.5s;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .input-area {
            width: 100%;
            padding: 18px;
            font-size: 1.3em;
            border: 3px solid #ddd;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-family: inherit;
            text-align: center;
        }

        .input-area:focus {
            outline: none;
            border-color: #8e2de2;
            box-shadow: 0 0 15px rgba(142, 45, 226, 0.3);
        }

        .input-area.correct {
            border-color: #27ae60;
            background: #eafaf1;
        }

        .input-area.incorrect {
            border-color: #e74c3c;
            background: #fdedec;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1em;
            display: none;
        }

        .feedback.correct {
            display: block;
            background: #d5f4e6;
            color: #27ae60;
            border-left: 5px solid #27ae60;
        }

        .feedback.incorrect {
            display: block;
            background: #fadbd8;
            color: #e74c3c;
            border-left: 5px solid #e74c3c;
        }

        .correct-answer {
            margin-top: 12px;
            padding: 12px;
            background: #fff3cd;
            border-left: 5px solid #f39c12;
            border-radius: 8px;
            font-size: 1em;
        }

        .button-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 16px 40px;
            font-size: 1.15em;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-home {
            background: #e74c3c;
            color: white;
        }

        .btn-home:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-check {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-check:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
        }

        .btn-next {
            background: #27ae60;
            color: white;
        }

        .btn-next:hover {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Results Screen */
        #results-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 40px 20px;
        }

        .results-container {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 25px;
            padding: 50px;
            max-width: 700px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .results-title {
            font-size: 3em;
            color: #2c3e50;
            margin-bottom: 25px;
        }

        .score-display {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            margin: 30px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            position: relative;
            animation: scaleIn 0.6s ease;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .score-percentage {
            font-size: 4em;
            font-weight: bold;
        }

        .score-label {
            font-size: 1.2em;
            margin-top: -10px;
        }

        .score-display::before {
            content: '';
            position: absolute;
            inset: -6px;
            border-radius: 50%;
            padding: 6px;
            background: linear-gradient(45deg, #8e2de2, #4a00e0);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }

        .feedback-message {
            font-size: 1.6em;
            margin: 25px 0;
            color: #555;
            font-weight: 600;
        }

        .score-breakdown {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
        }

        .breakdown-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #ddd;
            font-size: 1.15em;
        }

        .breakdown-row:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .menu-title {
                font-size: 2.5em;
            }

            .quiz-cards {
                grid-template-columns: 1fr;
                max-width: 400px;
            }

            .quiz-container, .info-container, .results-container {
                padding: 25px;
            }

            .question-word {
                font-size: 2.2em;
            }

            .question-text {
                font-size: 1.2em;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>

    <div class="saving-indicator" id="saving-indicator">üíæ Saving to Google Sheets...</div>

    <!-- Student Info Screen -->
    <div id="info-screen">
        <div class="info-container">
            <h1 class="info-title">üéØ Vocabulary Master</h1>
            <p class="info-subtitle">50 Advanced English Words</p>
            
            <div class="form-group">
                <label class="form-label" for="student-name">Your Name:</label>
                <input type="text" id="student-name" class="form-input" placeholder="Enter your full name" required>
            </div>

            <button class="btn-start" onclick="showMenu()">Continue ‚Üí</button>
        </div>
    </div>

    <!-- Menu Screen -->
    <div id="menu-screen">
        <h1 class="menu-title">üéØ Vocabulary Master</h1>
        <p class="menu-subtitle">Choose your challenge!</p>
        <div class="student-name-display" id="student-name-menu"></div>
        
        <div class="quiz-cards">
            <div class="quiz-card" onclick="startQuiz('translation')">
                <span class="quiz-icon">üá¨üáß ‚ûú üá∫üáø</span>
                <div class="quiz-title">English to Uzbek</div>
                <div class="quiz-description">See an English word, choose the correct Uzbek translation</div>
                <span class="quiz-count">25 Words</span>
            </div>

            <div class="quiz-card" onclick="startQuiz('gapfill')">
                <span class="quiz-icon">üìù‚ú®</span>
                <div class="quiz-title">Gap Filling</div>
                <div class="quiz-description">Complete sentences with the correct word from context</div>
                <span class="quiz-count">25 Sentences</span>
            </div>

            <div class="quiz-card" onclick="startQuiz('reverse')">
                <span class="quiz-icon">üá∫üáø ‚ûú üá¨üáß</span>
                <div class="quiz-title">Uzbek to English</div>
                <div class="quiz-description">See Uzbek word, type the English translation</div>
                <span class="quiz-count">25 Words</span>
            </div>
        </div>
    </div>

    <!-- Quiz Screen -->
    <div id="quiz-screen">
        <div class="quiz-container">
            <div class="progress-section">
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <div class="progress-text" id="progress-text">Question 1 of 25</div>
            </div>

            <div class="quiz-header">
                <h2 id="quiz-title"></h2>
                <div class="student-info-display-quiz" id="student-info-quiz"></div>
                <p class="question-counter" id="question-counter">Question 1</p>
            </div>

            <div class="question-card">
                <div id="question-content"></div>
            </div>

            <div class="button-container">
                <button class="btn-home" onclick="goHome()">üè† Menu</button>
                <button class="btn-check" id="check-btn" onclick="checkAnswer()" style="display:none;">‚úì Check</button>
                <button class="btn-next" id="next-btn" onclick="nextQuestion()" style="display:none;">Next ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="results-screen">
        <div class="results-container">
            <h2 class="results-title">üéâ Quiz Complete!</h2>
            <div class="score-display" id="score-circle">
                <div class="score-percentage" id="score-percentage">0%</div>
                <div class="score-label">Score</div>
            </div>
            <p class="feedback-message" id="feedback-message"></p>
            <div class="score-breakdown">
                <div class="breakdown-row">
                    <span>Correct:</span>
                    <span id="correct-count" style="color: #27ae60; font-weight: bold;">0</span>
                </div>
                <div class="breakdown-row">
                    <span>Incorrect:</span>
                    <span id="incorrect-count" style="color: #e74c3c; font-weight: bold;">0</span>
                </div>
                <div class="breakdown-row">
                    <span>Total Questions:</span>
                    <span id="total-questions" style="font-weight: bold;">25</span>
                </div>
            </div>
            <div class="button-container">
                <button class="btn-home" onclick="goHome()">üè† Back to Menu</button>
                <button class="btn-next" onclick="retakeQuiz()">üîÑ Try Again</button>
            </div>
        </div>
    </div>

    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz7XpqZskd2oZnrOybjPoqn83J4dvMtMvWM7qGsm2bqnEjOhtKvIVtrgioE8AWidiqF/exec';

        const vocabulary = [
            { en: "comfortable", uz: "qulay, shinam", example: "My bed is very _____." },
            { en: "expensive", uz: "qimmat", example: "This restaurant is very _____." },
            { en: "examination", uz: "imtihon", example: "The _____ is not difficult." },
            { en: "beautiful", uz: "chiroyli, go'zal", example: "Those flowers are very _____." },
            { en: "capital", uz: "poytaxt", example: "Paris is the _____ of France." },
            { en: "interested", uz: "qiziquvchi", example: "I am not _____ in football." },
            { en: "dangerous", uz: "xavfli", example: "Motor-racing is a _____ sport." },
            { en: "architect", uz: "arxitektor", example: "My sister is an _____." },
            { en: "castle", uz: "qal'a, qasr", example: "This _____ is one thousand years old." },
            { en: "heavy", uz: "og'ir", example: "These cases are very _____." },
            { en: "asleep", uz: "uxlab yotgan", example: "The dog is _____." },
            { en: "married", uz: "turmush qurgan", example: "Are you _____?" },
            { en: "single", uz: "bo'ydoq, turmush qurmagan", example: "I am still _____." },
            { en: "lawyer", uz: "advokat", example: "She is a _____." },
            { en: "cigarettes", uz: "sigaretlar", example: "Your _____ are in your bag." },
            { en: "tired", uz: "charchagan", example: "I am not _____." },
            { en: "hungry", uz: "och", example: "Are you _____?" },
            { en: "afraid", uz: "qo'rqadigan", example: "I am _____ of dogs." },
            { en: "cheap", uz: "arzon", example: "Diamonds are not _____." },
            { en: "tall", uz: "baland, bo'yli", example: "Is your father _____?" },
            { en: "weather", uz: "ob-havo", example: "The _____ is very nice today." },
            { en: "difficult", uz: "qiyin", example: "The examination is not _____." },
            { en: "favourite", uz: "sevimli", example: "Who is your _____ actor?" },
            { en: "angry", uz: "g'azablangan, jahldor", example: "Why is John _____ with me?" },
            { en: "country", uz: "mamlakat, davlat", example: "Canada is a very big _____." },
            { en: "apartment", uz: "xonadon, kvartira", example: "My _____ has three rooms." },
            { en: "excellent", uz: "a'lo, zo'r", example: "Your work is _____!" },
            { en: "necessary", uz: "zarur, kerakli", example: "Sleep is _____ for health." },
            { en: "surprised", uz: "hayron, ajablanuvchi", example: "I was _____ by the news." },
            { en: "thirsty", uz: "chanqoq", example: "I am very _____ now." },
            { en: "similar", uz: "o'xshash", example: "These two books are very _____." },
            { en: "different", uz: "boshqa, farqli", example: "They are completely _____." },
            { en: "patient", uz: "sabr-toqatli, bemor", example: "You need to be more _____." },
            { en: "nervous", uz: "asabiy, xavotirli", example: "I feel _____ before exams." },
            { en: "responsible", uz: "mas'ul, javobgar", example: "He is a very _____ person." },
            { en: "successful", uz: "muvaffaqiyatli", example: "She is a _____ businesswoman." },
            { en: "intelligent", uz: "aqlli", example: "My brother is very _____." },
            { en: "foreign", uz: "chet el, xorijiy", example: "I am learning a _____ language." },
            { en: "popular", uz: "mashhur", example: "This song is very _____." },
            { en: "ancient", uz: "qadimiy", example: "Rome is an _____ city." },
            { en: "modern", uz: "zamonaviy", example: "This is a _____ building." },
            { en: "crowded", uz: "gavjum, olomon", example: "The street is very _____." },
            { en: "empty", uz: "bo'sh", example: "The room is completely _____." },
            { en: "available", uz: "mavjud", example: "Is this book _____?" },
            { en: "suitable", uz: "mos, munosib", example: "This job is _____ for you." },
            { en: "terrible", uz: "dahshatli, juda yomon", example: "The weather was _____." },
            { en: "pleasant", uz: "yoqimli", example: "We had a _____ conversation." },
            { en: "polite", uz: "muloyim, odobli", example: "She is always very _____." },
            { en: "jealous", uz: "hasadgo'y, rashkchi", example: "Don't be _____ of others." },
            { en: "generous", uz: "saxiy", example: "He is very _____ with money." }
        ];

        let studentName = '';
        let currentQuizType = '';
        let currentQuestionIndex = 0;
        let score = 0;
        let totalQuestions = 25;
        let currentQuestions = [];
        let selectedAnswer = null;
        let questionResults = [];

        function showMenu() {
            studentName = document.getElementById('student-name').value.trim();

            if (!studentName) {
                alert('Please enter your name.');
                return;
            }

            document.getElementById('info-screen').style.display = 'none';
            document.getElementById('menu-screen').style.display = 'flex';
            document.getElementById('student-name-menu').textContent = `üë§ ${studentName}`;
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function generateTranslationQuiz() {
            const shuffled = shuffleArray(vocabulary).slice(0, 25);
            return shuffled.map(word => {
                const wrongAnswers = shuffleArray(
                    vocabulary.filter(w => w.en !== word.en)
                ).slice(0, 3).map(w => w.uz);
                
                const allOptions = shuffleArray([word.uz, ...wrongAnswers]);
                
                return {
                    type: 'translation',
                    word: word.en,
                    correct: word.uz,
                    options: allOptions
                };
            });
        }

        function generateGapFillQuiz() {
            const shuffled = shuffleArray(vocabulary).slice(0, 25);
            return shuffled.map(word => ({
                type: 'gapfill',
                sentence: word.example,
                correct: word.en.toLowerCase(),
                hint: word.uz
            }));
        }

        function generateReverseQuiz() {
            const shuffled = shuffleArray(vocabulary).slice(0, 25);
            return shuffled.map(word => ({
                type: 'reverse',
                word: word.uz,
                correct: word.en.toLowerCase()
            }));
        }

        function startQuiz(type) {
            currentQuizType = type;
            currentQuestionIndex = 0;
            score = 0;
            selectedAnswer = null;
            questionResults = [];

            if (type === 'translation') {
                currentQuestions = generateTranslationQuiz();
                document.getElementById('quiz-title').textContent = 'üá¨üáß ‚ûú üá∫üáø English to Uzbek';
            } else if (type === 'gapfill') {
                currentQuestions = generateGapFillQuiz();
                document.getElementById('quiz-title').textContent = 'üìù Gap Filling Challenge';
            } else if (type === 'reverse') {
                currentQuestions = generateReverseQuiz();
                document.getElementById('quiz-title').textContent = 'üá∫üáø ‚ûú üá¨üáß Uzbek to English';
            }

            document.getElementById('menu-screen').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'block';
            document.getElementById('results-screen').style.display = 'none';
            document.getElementById('student-info-quiz').textContent = `Student: ${studentName}`;

            loadQuestion();
        }

        function loadQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            selectedAnswer = null;

            const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `Question ${currentQuestionIndex + 1} of ${totalQuestions}`;
            document.getElementById('question-counter').textContent = `Question ${currentQuestionIndex + 1}`;

            let contentHTML = '';

            if (question.type === 'translation') {
                contentHTML = `
                    <div class="question-word">${question.word}</div>
                    <div class="question-text">Choose the correct Uzbek translation:</div>
                    <div class="options-grid" id="options-container">
                        ${question.options.map((opt, i) => 
                            `<button class="option-btn" onclick="selectOption(${i}, '${opt.replace(/'/g, "\\'")}')">${opt}</button>`
                        ).join('')}
                    </div>
                `;
            } else if (question.type === 'gapfill') {
                const sentenceWithBlank = question.sentence.replace('_____', '<span class="blank">_____</span>');
                contentHTML = `
                    <div class="sentence-context">${sentenceWithBlank}</div>
                    <div class="question-text">üí° Hint: ${question.hint}</div>
                    <input type="text" class="input-area" id="answer-input" placeholder="Type the missing word...">
                `;
            } else if (question.type === 'reverse') {
                contentHTML = `
                    <div class="question-word">${question.word}</div>
                    <div class="question-text">Write the English translation:</div>
                    <input type="text" class="input-area" id="answer-input" placeholder="Type your answer...">
                `;
            }

            contentHTML += '<div class="feedback" id="feedback"></div>';
            document.getElementById('question-content').innerHTML = contentHTML;

            if (question.type === 'translation') {
                document.getElementById('check-btn').style.display = 'none';
                document.getElementById('next-btn').style.display = 'none';
            } else {
                document.getElementById('check-btn').style.display = 'inline-block';
                document.getElementById('next-btn').style.display = 'none';
                setTimeout(() => {
                    const input = document.getElementById('answer-input');
                    if (input) input.focus();
                }, 100);
            }
        }

        function selectOption(index, answer) {
            const question = currentQuestions[currentQuestionIndex];
            selectedAnswer = answer;
            
            const options = document.querySelectorAll('.option-btn');
            options.forEach(btn => {
                btn.disabled = true;
                btn.onclick = null;
            });

            const isCorrect = answer === question.correct;
            
            options.forEach((btn, i) => {
                if (btn.textContent === question.correct) {
                    btn.classList.add('correct');
                } else if (i === index && !isCorrect) {
                    btn.classList.add('incorrect');
                }
            });

            questionResults.push({
                questionNumber: currentQuestionIndex + 1,
                quizType: currentQuizType,
                question: question.word,
                correctAnswer: question.correct,
                studentAnswer: answer,
                isCorrect: isCorrect
            });

            if (isCorrect) {
                score++;
                showFeedback(true);
            } else {
                showFeedback(false, question.correct);
            }

            document.getElementById('next-btn').style.display = 'inline-block';
            if (currentQuestionIndex === totalQuestions - 1) {
                document.getElementById('next-btn').textContent = 'See Results üéâ';
            }
        }

        function checkAnswer() {
            const question = currentQuestions[currentQuestionIndex];
            const input = document.getElementById('answer-input');
            const userAnswer = input.value.trim().toLowerCase();
            
            const isCorrect = userAnswer === question.correct;
            
            input.classList.add(isCorrect ? 'correct' : 'incorrect');
            input.disabled = true;

            questionResults.push({
                questionNumber: currentQuestionIndex + 1,
                quizType: currentQuizType,
                question: question.type === 'gapfill' ? question.sentence : question.word,
                correctAnswer: question.correct,
                studentAnswer: userAnswer,
                isCorrect: isCorrect
            });

            if (isCorrect) {
                score++;
                showFeedback(true);
            } else {
                showFeedback(false, question.correct);
            }

            document.getElementById('check-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-block';
            
            if (currentQuestionIndex === totalQuestions - 1) {
                document.getElementById('next-btn').textContent = 'See Results üéâ';
            }
        }

        function showFeedback(isCorrect, correctAnswer = null) {
            const feedback = document.getElementById('feedback');
            
            if (isCorrect) {
                feedback.className = 'feedback correct';
                feedback.innerHTML = '‚úì Correct! Excellent work!';
            } else {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = `‚úó Incorrect.`;
                if (correctAnswer) {
                    feedback.innerHTML += `<div class="correct-answer">Correct answer: <strong>${correctAnswer}</strong></div>`;
                }
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;

            if (currentQuestionIndex < totalQuestions) {
                loadQuestion();
                document.getElementById('next-btn').textContent = 'Next ‚Üí';
            } else {
                showResults();
            }
        }

        async function showResults() {
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('results-screen').style.display = 'flex';

            const percentage = Math.round((score / totalQuestions) * 100);
            const incorrect = totalQuestions - score;

            document.getElementById('score-percentage').textContent = percentage + '%';
            document.getElementById('correct-count').textContent = score;
            document.getElementById('incorrect-count').textContent = incorrect;
            document.getElementById('total-questions').textContent = totalQuestions;

            const scoreCircle = document.getElementById('score-circle');
            const feedbackMessage = document.getElementById('feedback-message');

            if (percentage >= 90) {
                scoreCircle.style.background = 'linear-gradient(135deg, #27ae60, #229954)';
                feedbackMessage.textContent = 'üåü Outstanding! Vocabulary Master!';
            } else if (percentage >= 75) {
                scoreCircle.style.background = 'linear-gradient(135deg, #3498db, #2980b9)';
                feedbackMessage.textContent = 'üëç Great job! Keep learning!';
            } else if (percentage >= 60) {
                scoreCircle.style.background = 'linear-gradient(135deg, #f39c12, #e67e22)';
                feedbackMessage.textContent = 'üìö Good effort! Practice more!';
            } else {
                scoreCircle.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
                feedbackMessage.textContent = 'üí™ Keep studying! You\'ll improve!';
            }

            await sendToGoogleSheets();
        }

        async function sendToGoogleSheets() {
            const indicator = document.getElementById('saving-indicator');
            indicator.style.display = 'block';

            try {
                const timestamp = new Date().toLocaleString();
                const percentage = Math.round((score / totalQuestions) * 100);

                let quizTypeName = '';
                if (currentQuizType === 'translation') quizTypeName = 'English to Uzbek';
                else if (currentQuizType === 'gapfill') quizTypeName = 'Gap Filling';
                else if (currentQuizType === 'reverse') quizTypeName = 'Uzbek to English';

                const data = {
                    timestamp: timestamp,
                    studentName: studentName,
                    quizType: 'Vocabulary - ' + quizTypeName,
                    score: score,
                    totalQuestions: totalQuestions,
                    percentage: percentage,
                    results: questionResults
                };

                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                indicator.textContent = '‚úì Results saved successfully!';
                indicator.style.background = 'rgba(39, 174, 96, 0.9)';
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 3000);

            } catch (error) {
                console.error('Error saving to Google Sheets:', error);
                indicator.textContent = '‚ö† Could not save to Google Sheets';
                indicator.style.background = 'rgba(231, 76, 60, 0.9)';
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 3000);
            }
        }

        function goHome() {
            document.getElementById('menu-screen').style.display = 'flex';
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('results-screen').style.display = 'none';
        }

        function retakeQuiz() {
            startQuiz(currentQuizType);
        }

        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const checkBtn = document.getElementById('check-btn');
                const nextBtn = document.getElementById('next-btn');
                
                if (checkBtn && checkBtn.style.display !== 'none') {
                    checkAnswer();
                } else if (nextBtn && nextBtn.style.display !== 'none') {
                    nextQuestion();
                }
            }
        });
    </script>

</body>
</html>
